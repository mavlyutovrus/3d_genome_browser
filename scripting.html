<!DOCTYPE html>
<html>
  <head>
    <title>The page for Scripting with 3D Genome Browser's API</title>
    <script src="js/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="js/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="js/codemirror/theme/3024-night.css">
    <script src="js/codemirror/mode/javascript/javascript.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="content/geneData.json"></script>
    <style>
        .CodeMirror {
          border: 1px solid #eee;
          height: auto;
        }

        .CodeMirror-scroll {
          overflow-y: hidden;
          overflow-x: auto;
        }



    </style>
  </head>
  <body>
    <h1 align="center">SCRIPTING PAGE</h1>
    <p>Here is the page with jquery libraries and preloaded gene data. Use javascript console in your web browser for using <i>3D Genome Browser</i>'s API. Also this page is the storage of scripts that people use for achieving various results in exploring 3D genome.</p>

    <table border="1" style="width:100%">
      <tr>
        <th>ID</th>
        <th>Description</th>
        <th>Author</th>
        <th>Link</th>
      </tr>
      <tr>
        <td>1</td>
        <td>Combination of different stuff. (At this moment - mess). Main function is <i>getRangesForGenePromoterCubicArea(chr, geneStart, geneEnd, isNormal, radiusCube, isPositive)</i>. Use it like<br><b>getRangesForGenePromoterCubicArea('13', 48877883, 49056026, true, 0.2, true); /*37Release RB1 gene*/</b><br> to get all the stands in radius <i>0.2</i> from the promoter for <i>GM06990</i> cell line.</td>
        <td>Alexander Butyaev</td>
        <td><a href="scripting/mess.js" target="_blank">script</a></td>
      </tr>
    </table>
    <br>
    <h3>Your code</h3>
    <p>(Use standard javascript here. To output any results, use integrated <i>function print(value)</i>.)</p>
    <p><textarea id="code" name="code"></textarea></p>
    <button onclick="run()"> Run </button> <button onclick="save()"> Save </button>
    <br><br>
    <h3>Output</h3>
    <textarea readonly id="display" style="height: 50px; width: 100%;"></textarea>
    <br>
    <p>If you want to share your script(s), please email to Alexander Butyaev <i>alexander . butyaev at mail . mcgill . ca</i></p>
    <script>
        // var myCodeMirror = CodeMirror(document.body);
        var code = document.getElementById("code");
        var display=document.getElementById("display")
        window.onload = function() {
                window.editor = CodeMirror.fromTextArea(code, {
                    mode: "javascript",
                    lineNumbers: true,
                    matchBrackets: true,
                    lineWrapping: true,
                    theme : '3024-night'
                });
                editor.setValue("print('Curiosity is the key to creativity!');\nvar len = 1;\nfor(var i = 0; i < len; i++) {\n\tprint('Do you agree?');\n}");
            };
        

        function run() {
            var result = eval(editor.getValue());
            var el = $("#display").get(0);
            var elemLen = el.value.length;
            el.selectionStart = elemLen;
            el.selectionEnd = elemLen;
            el.focus();
            return result;
        }

        function save() {
            var mydata = 'function print(value) {console.log(value);}\n' + editor.getValue() + '\n';
            window.location.href = 'data:text/javascript;charset=UTF-8,'
                + encodeURIComponent(mydata);
        }
        
        function print(value) {
            display.innerHTML+= value + "\n";
        }
        
    </script>
  </body>
</html>