<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Genome Maps</title>

	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="http://cdn.sencha.com/ext/gpl/4.1.1/resources/css/ext-all-gray.css">
	<link rel="stylesheet" type="text/css" href="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb/install/ChemDoodleWeb.css">
	<link rel="stylesheet" type="text/css" href="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.qtip.min.css">
 	<link rel="stylesheet" type="text/css" href="http://jsapi.bioinfo.cipf.es/libs/resources/css/style.css">  
  
	<!-- Google Analytics -->

	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-16414504-2']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

  
	<!-- EXT-LIBS -->


	<!-- Ext-js -->
	<script type="text/javascript" src="http://cdn.sencha.com/ext/gpl/4.1.1/ext-all.js"></script>
	<script type="text/javascript" src="http://cdn.sencha.com/ext/gpl/4.1.1/examples/shared/examples.js"></script>
	

	<!-- jQuery -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.qtip.min.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.sha1.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.url.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.cookie.js"></script>  
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jqXMLUtils.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-plugins/jquery.smartresize.js"></script>
	<!--<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/jquery-mousewheel-3.0.6/jquery.mousewheel.min.js"></script>-->

	
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/xml2json.js"></script>
	
	<!-- Canvas to SVG converters -->
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/base64.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/canvas2image.js"></script>
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/canvg.js"></script> 
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/svg/rgbcolor.js"></script> 
	
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/rawdeflate.js"></script> 
	
<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/BlobBuilder.js/master/BlobBuilder.min.js"/></script> -->
<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/canvas-toBlob.js/master/canvas-toBlob.min.js"/></script> -->
<!-- 	<script type="text/javascript" src="https://raw.github.com/eligrey/FileSaver.js/master/FileSaver.min.js"/></script> -->
	
	
	
	<!-- CHEMDOODLE -->
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb/install/ChemDoodleWeb-libs.js"></script> 
	<script type="text/javascript" src="http://jsapi.bioinfo.cipf.es/ext-libs/ChemDoodleWeb/install/ChemDoodleWeb.js"></script> 
	
	
	<!-- genome-maps-config -->
	<script type="text/javascript" src="./config/gm-config.json"></script>
	
	
	<!-- LIBS -->
	<!-- js-common-libs utils -->
	<script type="text/javascript" src="../js-common-libs/utils/event.js"></script>
	<script type="text/javascript" src="../js-common-libs/utils/svg.js"></script> 
	<script type="text/javascript" src="../js-common-libs/utils/normalization.js"></script>
	<script type="text/javascript" src="../js-common-libs/utils/colors.js"></script>
	<script type="text/javascript" src="../js-common-libs/utils/compbio.js"></script>
	



	<!-- wum ui-widgets -->
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/header-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/user-list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/job-list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/data-list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/paged-view-list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/user-bar-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/upload-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/login-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/edit-user-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/result-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/result-table.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/browser-data-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/gcsa-browser-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/manage-projects-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ui-widgets/check-browser.js"></script>
	
	<!-- wum ws-manager -->
	<script type="text/javascript" src="../js-common-libs/wum/ws-manager/wum-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/wum/ws-manager/wum-rest-adapter.js"></script>
	


	<!-- js-common-libs genome-viewer -->
	<script type="text/javascript" src="../js-common-libs/genome-viewer/file-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/legend-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/legend-panel.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/url-widget.js"></script>
	
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gv-config.json"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/feature-binary-search-tree.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/genome-viewer.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/track-svg.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/track-svg-layout.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/track-data.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/track-settings-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/feature-cache.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/feature-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/chromosome-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/circular-chromosome-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/karyotype-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/data-source.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/cellbase-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/file-data-source.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/string-data-source.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/url-data-source.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/vcf-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gff2-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gff3-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gtf-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/bed-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/tabular-data-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/das-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/vcf-file-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gff-file-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gtf-file-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/bed-file-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/sequence-adapter.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/region.js"></script>

	<script type="text/javascript" src="../js-common-libs/genome-viewer/gcsa-rest-manager.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/gcsa-manager.js"></script>
<!-- <script type="text/javascript" src="../js-common-libs/genome-viewer/dqs-adapter.js"></script> -->
	<script type="text/javascript" src="../js-common-libs/genome-viewer/bam-cache.js"></script>
	<script type="text/javascript" src="../js-common-libs/genome-viewer/bam-adapter.js"></script>
	
	<!-- js-common-libs cellbase ui-widgets -->
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/info-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/gene-info-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/protein-info-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/snp-info-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/transcript-info-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/cellbase/ui-widgets/vcf-variant-info-widget.js"></script>
	
	<!-- js-common-libs cellbase ws-manager -->
	<script type="text/javascript" src="../js-common-libs/cellbase/cellbase-manager.js"></script>
	
	
	

	<!-- js-common-libs ui-widgets -->
	<script type="text/javascript" src="../js-common-libs/ui-widgets/ux-window.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/attributes/genomic-attributes-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/attributes/expression-genomic-attributes-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/attributes/genotype-genomic-attributes-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/attributes/attributes-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/attributes/attributes-panel.js"></script>
	
	<script type="text/javascript" src="../js-common-libs/ui-widgets/list/list-panel.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/list/list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/list/genomic-list-panel.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/list/genomic-list-widget.js"></script>

	<script type="text/javascript" src="../js-common-libs/ui-widgets/input-list-widget.js"></script>
	<script type="text/javascript" src="../js-common-libs/ui-widgets/chart-widget.js"></script>



	<!-- genome-maps -->
	<script type="text/javascript" src="./config/gm-config.json"></script>
	<script type="text/javascript" src="./config/gm-plugins-config.json"></script>
	<script type="text/javascript" src="./genome-maps.js"></script>
	
	<!-- genome-maps plugins -->	
	<script type="text/javascript" src="./plugins/generic-plugin.js"></script>
	<script type="text/javascript" src="./plugins/my-plugin.js"></script>
	<script type="text/javascript" src="./plugins/expression.js"></script>
	<script type="text/javascript" src="./plugins/genotype.js"></script>





	<script>
	// 	Ext.application({
	// 	    launch: run
	// 	});

	// var control_callback = false;
	var control_callback_arr = [];
	
	function sendChangeInGenomeMapsWindow(_chr, _start_position, _end_position) {
		console.log(control_callback_arr)
		console.log(_chr + ', ' + _start_position +', ' + _end_position)
		if (!(control_callback_arr && (control_callback_arr[0] == _chr && control_callback_arr[1] == _start_position && control_callback_arr[2] == _end_position) )) {
			if (window.opener){
			    window.opener.postMessage('changeInGenomeMapsWindow_R2O' + ":" +
	              'chr' + _chr + ' ' + _start_position + '-' + _end_position,'http://3dgb.cs.mcgill.ca');
			} else {
				console.log("changed location")
			}
		}
    }

	Ext.Loader.setConfig({enabled: true});
	Ext.Loader.setPath('Ext.ux', 'http://cdn.sencha.com/ext/gpl/4.1.1/examples/ux');
	Ext.QuickTips.init();
	Ext.require([
	    'Ext.ux.grid.FiltersFeature',
	    'Ext.grid.PagingScroller',
	    'Ext.ux.data.PagingMemoryProxy'
	]);
	
	var counter = 1000000;
	function test(ms,positions){
		if (ms==null){ms = 200;}
		if (positions==null){positions = 250000;}
		genomeMaps.genomeViewer.trackSvgLayout.onMove.notify(-1)
		setTimeout("test()", ms);
		counter = counter + positions;
	}
	
	Ext.onReady(run);
	var genomeMaps;
	function run(){
		CheckBrowser();
// 		var pathname = window.location.href;
// 		console.log(pathname);
		genomeMaps = new GenomeMaps("mydiv"); //the div must exist
		
// 		genomeMaps.addPlugin();
// 		console.log(Ext.ComponentManager.getCount());
		genomeMaps.draw();
	// 	console.log(Ext.ComponentManager.getCount());
		
// 		gv = new GenomeViewer("mydiv");
// 		gv.draw();
	
	
	// gv1.setSpecies("Mus musculus");
	// var gv2 = new GenomeViewer("gv_div1");
// 	gv2.draw();
	
	
	
	
	
	//GenomeViewer v2
// 	gv1 = new GenomeViewer("mydiv",AVAILABLE_SPECIES[0],{
// 		//toolbar: Ext.create('Ext.toolbar.Toolbar', {height:27}),
// 		availableSpecies: AVAILABLE_SPECIES
// 	});
// 	gv1.draw();
	
		//RUN TEST
		if ($.url().param('test') == "true") {
			setTimeout("test()", 2000);
		}
	}

	var handleChangeIn3DGBWindow = function(e) {
    	if(e.origin == 'http://3dgb.cs.mcgill.ca') {
          var action = e.data.split(':')[0]
          if(action == 'changeIn3DGBWindow_O2R') {
            var location_pars = e.data.split(':')[1].split(',');
            control_callback_arr = location_pars
            var str = location_pars[0]+":"+location_pars[1]+"-"+location_pars[2];
            $('#'+genomeMaps.genomeViewer.id + 'tbCoordinate-inputEl')[0].value = str;
            genomeMaps.genomeViewer.region.parse(str);
			genomeMaps.genomeViewer.onRegionChange.notify({sender:"GoButton"});
			// control_callback = true;
          }
        }
	}

	window.addEventListener('message', handleChangeIn3DGBWindow, false);
	
	</script>
</head>
<body style="overflow: hidden">
	<div id="checkBrowser"></div>
	<div id="mydiv"></div>
</body>
</html>
